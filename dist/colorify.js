!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.colorify=t()}(this,function(){"use strict";var n=function(n){return null!=n},t=function(n){return"string"==typeof n},r=function(n){return"function"==typeof n},e=function(n){return Array.isArray(n)?n:[n]},o=function(n){return Array.isArray(n)&&!t(n[0])&&"value"in n[0]},u=function(n){return o(n)?[n]:e(n)},a=function(n,t){var r=document.createElement("canvas");return r.width=n,r.height=t,r},i=function(){var n=a(1,1),t=n.getContext("2d");return t.globalCompositeOperation="screen","screen"===t.globalCompositeOperation},f=i(),c=function(n){return new Promise(function(t){return setTimeout(t,n)})},h=function(n,t){var r=document.createElement("img");r.onload=r.onerror=t,r.src=n},s=function(n,t){return new Promise(function(r){return Promise.race([h(n,r),c(t)])})},g=function(n,t){var r=n.map(function(n){return s(n,t.timeout)});return Promise.all(r)},l=function(n,t,r,e){return Object.keys(t).reduce(function(o,u){return o[u]=r(n[u])?e(n[u]):t[u],o},{})},m=function(n){return!!n},d=function(n){return n},v=function(e,o){var u=l(e,o.booleans,n,m),a=l(e,o.strings,t,d),i=l(e,o.functions,r,d);return Object.assign({},u,a,i,e)},p=function(e,o){var u=e.strategy,a=n(u)?u:"average";return a=t(u)&&u in o?o[u]:u,a=r(u)?u:o.average},y=function(n,t,r){return Math.floor((n+t+r)/3)},w=function(n,t,r){return Math.floor(.2125*n+.7154*t+.0721*r)},b=Math.max,x=Math.min,C={average:y,grayscale:w,max:b,min:x},M=function(n,t){var r=a(n.width,n.height),e=r.getContext("2d");e.drawImage(n,0,0);for(var o=e.getImageData(0,0,r.width,r.height),u=o.data,i=0,f=0;f<u.length;f+=4)u[f+3]&&(u[f]=u[f+1]=u[f+2]=t(u[f],u[1],u[2]),i=Math.max(i,u[f]));for(var c=255-i,h=0;h<u.length;h+=4)if(u[h+3]){var s=u[h];u[h]=u[h+1]=u[h+2]=s+c}return e.putImageData(o,0,0),r},I=function(n,t){return g(n,t).then(function(n){return n.map(function(n){return M})})},E=function(n,t){n=e(n);var r={booleans:{},strings:{},functions:{}},o=v(t,r);return o.strategy=p(o,C),I(n,o).then(function(t){return n.map(function(n){return t[n]})})},D=function(n,t,r,e){var u=void 0;o(t)?(u=n.createLinearGradient(r/2,0,r/2,e),t.forEach(function(n){u.addColorStop(n.value,n.color)})):u=t,n.fillStyle=u,n.fillRect(0,0,r,e)},O=function(n,t,r){var e=n.width,o=n.height;t.forEach(function(t,u){var a=t.getContext("2d");D(a,e,o,r[u]),a.globalCompositeOperation="multiply",a.drawImage(n,0,0),a.globalCompositeOperation="destination-atop",a.drawImage(n,0,0)})},A=function(n,t,r){var e=n.width,o=n.height,u=n.getContext("2d"),a=u.getImageData(0,0,e,o),i=a.data,f=[],c=[];t.forEach(function(n,t){var u=n.getContext("2d");D(u,e,o,r[t]);var a=u.getImageData(0,0,e,o);f.push(u),c.push(a)});for(var h=function(n,t){return function(r,e){r[e]=Math.floor(n*r[e]),r[e+1]=Math.floor(n*r[e+1]),r[e+2]=Math.floor(n*r[e+2]),r[e+3]=t}},s=function(n){i[n+3]&&c.forEach(function(t){var r=h(i[n]/255,i[n+3]);r(t.data,n)})},g=0;g<i.length;g+=4)s(g);f.forEach(function(n,t){n.putImageData(i[t],0,0)})},P=function(n,t){var r=n.width,e=n.height,o=t.map(function(){return a(r,e)}),u=f?O:A;return u(n,o,t),o.map(function(n){return n.toDataURL()})},j=function(n,t,r){var u={booleans:{},strings:{},functions:{}};return r=v(r,u),t=o(t)?[t]:e(t),P(n,t)},L=function(n,t){var r=n.map(function(n){return n.url});return g(r).then(function(n){return E(n,t)}).then(function(n){return j(n,t)})},R=function(n,t,r){return n=e(n),t=u(t),E(n,r).then(function(e){return e.reduce(function(e,o,u){var a=n[u];return e.has(a)||e.set(a,L(o,t,r)),e},new Map)}).then(function(t){return n.map(t.get)})};return R});
//# sourceMappingURL=colorify.js.map
